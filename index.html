<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css"/>
    <link rel="manifest" href="manifest.json"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'/>
    <link rel="stylesheet" href="/buttons.css"/>
    <link rel="stylesheet" href="/forms.css"/>
    <link rel="stylesheet" href="/popups.css"/>
    <script>
        
        async function requestLocationUpdate() {
            if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(
                async function(position) {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                console.log("Latitude:", lat);
                console.log("Longitude:", lon);

                
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
                    if (response.ok) {
                    const data = await response.json();
                    const place = data.display_name || "Unknown location";
                    console.log("Location (place name):", place);
                    // Optionally, display on page:
                    document.querySelector('.notification').textContent = `You are at: ${place}`;
                    } else {
                    console.error("Failed to fetch place name.");
                    }
                } catch (err) {
                    console.error("Error during reverse geocoding:", err);
                }
                },
                function(error) {
                console.error("Error getting location:", error.message);
                document.querySelector('.notification').textContent = "Unable to get your location.";
                }
            );
            } else {
            console.error("Geolocation is not supported by this browser.");
            document.querySelector('.notification').textContent = "Geolocation is not supported by this browser.";
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            requestLocationUpdate();
        });
        if (navigator.permissions) {
            navigator.permissions.query({ name: 'geolocation' })
            .then(permissionStatus => {
                console.log('Geolocation permission status:', permissionStatus.state);
                permissionStatus.onchange = () => {
                    console.log('Geolocation permission changed to:', permissionStatus.state);
                };
            })
            .catch(error => {
                console.error('Error querying geolocation permission:', error);
            });
        } else {
            console.warn('Permissions API not supported in this browser.');
        }


        if ("vibrate" in navigator) {
            try {
                
                navigator.vibrate(200);
                console.log("Vibration permission requested.");
            } catch (e) {
                console.error("Vibration not permitted or failed:", e);
            }
        } else {
            console.log("Vibration API not supported.");
        }
        

        if ('caches' in window) {
            caches.open('orion-cache').then(cache => {
                cache.addAll([
                    '/index.html',
                    '/style.css',
                    '/app.js',
                    '/manifest.json',
                    '/icon.png',
                    '/buttons.css',
                    '/forms.css',
                    '/popups.css'
                ]).then(() => {
                    console.log('Assets cached successfully.');
                }).catch(error => {
                    console.error('Failed to cache assets:', error);
                });
            });
        } else {
            console.warn('Cache API not supported in this browser.');
        }

       
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch(error => {
                    console.error('Service Worker registration failed:', error);
                });
            });
        } else {
            console.warn('Service Workers are not supported in this browser.');
        }
        
            if ('Notification' in window && Notification.permission === 'granted' && navigator.serviceWorker) {
                navigator.serviceWorker.ready.then(reg => {
                    reg.showNotification('Plaxedas Installed', {
                        body: `Plaxedas has been successfully installed on your ${deviceDetails} in ${place}.`,
                        icon: '/ff.png'
                    });
                });
            }
        });
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                if (typeof deferredPrompt !== 'undefined' && deferredPrompt) {
                    const installBtn = document.createElement('button');
                    installBtn.textContent = 'Install plaxedas';
                    installBtn.className = 'install-btn';
                    installBtn.style.position = 'fixed';
                    installBtn.style.bottom = '20px';
                    installBtn.style.right = '20px';
                    installBtn.style.zIndex = '1000';
                    document.body.appendChild(installBtn);

                    installBtn.addEventListener('click', async () => {
                        installBtn.style.display = 'none';
                        deferredPrompt.prompt();
                        await deferredPrompt.userChoice;
                        deferredPrompt = null;
                    });
                }
            }, 10000);
        });
        


        if ('Notification' in window && navigator.serviceWorker) {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    navigator.serviceWorker.ready.then(registration => {
                        registration.showNotification('Welcome to the plaxedas!', {
                            body: 'Your secure and private space for all kinds of shopping and service.',
                            icon: '/ff.png'
                        });
                    });
                } else {
                    console.warn('Notification permission denied.');
                }
            });
        } else {
            console.warn('Notifications are not supported in this browser.');
        }

        

    </script>
    <title>plaxedas</title>
    
</head>
<body>
    <header class="app-header"></header>
    <section class="app"></section>
    <main class="app-main"></main>
    <section class="notification"></section>
    <br><br><br><br><br><br>
    <footer class="app-footer"></footer>
    <script src="/app.js"></script>
    <script src="/form.js"></script>
    <script src="/popups.js"></script>
    <script src="/buttons.js"></script>
    <script src="/regulators.js"></script>
    

    
</body>
</html>



